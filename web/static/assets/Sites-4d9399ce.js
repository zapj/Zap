import{_ as _e,d as ve,c as B,r as v,u as he,J as W,a as p,b as U,j as a,w as l,B as G,K as h,m as ye,h as T,g as _,f as V,i as q,M as F,k as y,C as Ee,T as Ce,a1 as ke,l as ze,q as P,o as $e,a2 as Ve,F as j,L as f,e as A,a3 as Se}from"./index-14135f82.js";/* empty css                   */import{d as De,a as Ie,u as Le}from"./el-overlay-72203abe.js";import{E as Te,a as Fe}from"./el-form-item-52dd2392.js";/* empty css                 *//* empty css               */import{E as Ae,a as Ue,b as Re}from"./el-pagination-b1814900.js";import{b as Be}from"./el-tooltip-c2c212f1.js";/* empty css                */import{E as We}from"./el-card-5834d095.js";import{E as qe,a as Oe}from"./el-table-column-f59bea0d.js";import{E as Pe}from"./el-empty-f8024364.js";import{u as J,E as He}from"./el-button-d6781fe8.js";/* empty css                        */import{E as Me,a as Ne,b as je}from"./el-dropdown-item-475f10c0.js";import{a as z,v as Je}from"./client-deceb825.js";import{f as Ke,p as Ge,g as Qe,h as Xe}from"./index-51c50e5f.js";import{I as K}from"./iconify-b58b61eb.js";import{_ as Ye}from"./_plugin-vue_export-helper-c27b6911.js";import{E as Ze}from"./index-f75e8995.js";import{E as Q,c as xe,d as et}from"./index-dace46a3.js";import{b as tt}from"./runtime-34f45f03.js";import{b as c}from"./index-930baad5.js";import{E as ot}from"./index-86496eda.js";import"./event-8e91c63d.js";import"./use-form-common-props-eb60e3ec.js";import"./use-form-item-a31821c7.js";import"./castArray-affe13dd.js";import"./error-78e43d3e.js";import"./_initCloneObject-f9c726fd.js";import"./index-7421c357.js";import"./isNil-c75b1b34.js";const at=tt({...De,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0},headerAriaLevel:{type:String,default:"2"}}),lt=Ie,it=ve({name:"ElDrawer",components:{ElOverlay:Ze,ElFocusTrap:Be,ElIcon:Q,Close:Ke},inheritAttrs:!1,props:at,emits:lt,setup(e,{slots:u}){J({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},B(()=>!!u.title)),J({scope:"el-drawer",from:"custom-class",replacement:"class",version:"2.3.0",ref:"https://element-plus.org/en-US/component/drawer.html#attributes",type:"Attribute"},B(()=>!!e.customClass));const w=v(),S=v(),E=he("drawer"),{t:m}=xe(),b=B(()=>e.direction==="rtl"||e.direction==="ltr"),D=B(()=>et(e.size));return{...Le(e,w),drawerRef:w,focusStartRef:S,isHorizontal:b,drawerSize:D,ns:E,t:m}}}),st=["aria-label","aria-labelledby","aria-describedby"],nt=["id","aria-level"],rt=["aria-label"],dt=["id"];function pt(e,u,w,S,E,m){const b=W("close"),D=W("el-icon"),o=W("el-focus-trap"),g=W("el-overlay");return p(),U(ke,{to:"body",disabled:!e.appendToBody},[a(Ce,{name:e.ns.b("fade"),onAfterEnter:e.afterEnter,onAfterLeave:e.afterLeave,onBeforeLeave:e.beforeLeave,persisted:""},{default:l(()=>[G(a(g,{mask:e.modal,"overlay-class":e.modalClass,"z-index":e.zIndex,onClick:e.onModalClick},{default:l(()=>[a(o,{loop:"",trapped:e.visible,"focus-trap-el":e.drawerRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:l(()=>[h("div",ye({ref:"drawerRef","aria-modal":"true","aria-label":e.title||void 0,"aria-labelledby":e.title?void 0:e.titleId,"aria-describedby":e.bodyId},e.$attrs,{class:[e.ns.b(),e.direction,e.visible&&"open",e.customClass],style:e.isHorizontal?"width: "+e.drawerSize:"height: "+e.drawerSize,role:"dialog",onClick:u[1]||(u[1]=T(()=>{},["stop"]))}),[h("span",{ref:"focusStartRef",class:_(e.ns.e("sr-focus")),tabindex:"-1"},null,2),e.withHeader?(p(),V("header",{key:0,class:_(e.ns.e("header"))},[e.$slots.title?q(e.$slots,"title",{key:1},()=>[y(" DEPRECATED SLOT ")]):q(e.$slots,"header",{key:0,close:e.handleClose,titleId:e.titleId,titleClass:e.ns.e("title")},()=>[e.$slots.title?y("v-if",!0):(p(),V("span",{key:0,id:e.titleId,role:"heading","aria-level":e.headerAriaLevel,class:_(e.ns.e("title"))},F(e.title),11,nt))]),e.showClose?(p(),V("button",{key:2,"aria-label":e.t("el.drawer.close"),class:_(e.ns.e("close-btn")),type:"button",onClick:u[0]||(u[0]=(...r)=>e.handleClose&&e.handleClose(...r))},[a(D,{class:_(e.ns.e("close"))},{default:l(()=>[a(b)]),_:1},8,["class"])],10,rt)):y("v-if",!0)],2)):y("v-if",!0),e.rendered?(p(),V("div",{key:1,id:e.bodyId,class:_(e.ns.e("body"))},[q(e.$slots,"default")],10,dt)):y("v-if",!0),e.$slots.footer?(p(),V("div",{key:2,class:_(e.ns.e("footer"))},[q(e.$slots,"footer")],2)):y("v-if",!0)],16,st)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[Ee,e.visible]])]),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["disabled"])}var ut=_e(it,[["render",pt],["__file","drawer.vue"]]);const mt=ze(ut);const ft={class:"card-header font-size-3"},ct={class:"el-dropdown-link"},wt=["id"],gt={style:{float:"left"}},bt={style:{float:"right",color:"var(--el-text-color-secondary)"}},_t={style:{flex:"auto"}},$="140px",vt={__name:"Sites",setup(e){let u=!1;const w=v([]),S=v(400),E=v(),m=v(!1),b=v("50%"),D=v("添加网站"),o=P({domain:"",title:"",description:"",domain_names:"",www_root:"",run_directory:"",application:0,website_id:0,index_files:"index.html index.htm index.php"}),g=P({config:{}}),r=P({total:0,pagesize:50,currentpage:1,tbLoading:!1}),X={domain:[{required:!0,trigger:"blur",validator:(s,t,n)=>{t==""&&t===void 0&&n(new Error("域名不能为空")),z({url:"v1/website/check_domain",dataType:"form",data:{domain:t,website_id:o.website_id},method:"POST",loading:!1}).then(d=>{d.code===0?n():n(new Error(d.msg))}).catch(d=>{n(new Error("域名验证失败"))})}},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],title:[{required:!0,message:"请输入网站名称",trigger:"blur"}],www_root:[{required:!0,message:"请输入站点目录",trigger:"blur"}],application:[{required:!0,message:"请选择应用类型",trigger:"change"}]};$e(()=>{I({page:1,pagesize:r.pagesize}),window.addEventListener("resize",O)}),Ve(()=>{window.removeEventListener("resize",O)});const Y=()=>{o.www_root===""&&(o.www_root=o.domain.replaceAll("*.","")),o.title===""&&(o.title=o.domain.replaceAll("www.",""))},Z=()=>z({url:"/v1/website/config",method:"get"}).then(s=>{if(s.code===0)g.config=s.data;else{c.error(s.msg),m.value=!1;return}}),H=(s,t)=>{z({url:"/v1/website/set/status",method:"post",data:{id:w.value[s].ID,status:t},dataType:"form"}).then(n=>{n.code===0?(c.success(n.msg),I({page:1,pagesize:r.pagesize})):c.error(n.msg)})},M=s=>{u=!0,m.value=!0,D.value="网站设置",o.website_id=s,z({url:"/v1/website/settings",method:"get",params:{id:s}}).then(t=>{if(t.code===0)g.config=t.data.config,o.domain=t.data.website.domain,o.domain_names=t.data.website.domain_names,o.www_root=t.data.website.www_root,o.run_directory=t.data.website.run_directory,o.application=t.data.website.application_id,o.title=t.data.website.title,o.description=t.data.website.description,o.index_files=t.data.website.index_files,o.website_id=t.data.website.ID,o.www_root===""?o.www_root=o.domain.replaceAll("*.",""):o.www_root=t.data.website.www_root.replace(g.config.home_dir+"/",""),o.title===""&&(o.title=o.domain.replaceAll("www.",""));else{c.error(t.msg),m.value=!1;return}})},x=s=>{s&&(s.resetFields(),m.value=!1)},ee=s=>{Z().finally(()=>{m.value=!0}),u=!1,o.website_id=0,s&&s.resetFields()},te=s=>{if(!s)return;s.validate(d=>{if(!d)return!1});let t=Object.assign({},o);if(g.config.applications.length===0){c.error("请先添加应用");return}let n=null;if(g.config.applications.forEach((d,R)=>{d.id===o.application&&(n=d)}),!n){c.error("应用不存在");return}t.expose_port=n.expose_port,t.expose_proto=n.expose_proto,t.application=n.id,z({url:u?"/v1/website/update":"/v1/website/create",method:"post",data:t}).then(d=>{d.code===0?(c.success(u?"更新成功":"添加成功"),I({page:1,pagesize:r.pagesize})):c.error(d.msg)}).finally(()=>{m.value=!1,s.resetFields()})},oe=s=>{M(s)},ae=()=>{I({page:r.currentpage,pagesize:r.pagesize})},le=(s,t)=>{r.currentpage=s,r.pagesize=t,I({page:s,pagesize:t})},O=()=>{document.body.clientWidth<1200&&document.body.clientWidth>768?b.value="60%":document.body.clientWidth<768?b.value="100%":b.value="50%";let s=document.body.clientHeight-215-140;s<300?S.value=300:S.value=s};function I(s){s=Object.assign({page:1,pagesize:50},s),r.tbLoading=!0,z({url:"/v1/website/list",method:"get",params:{path:s.path,page:s.page,limit:s.pagesize},dataType:"form",loading:!1}).then(n=>{w.value=[],w.value.push(...n.data),r.total=n.total,r.currentpage=n.page,O()}).catch(n=>{console.log(n)}).finally(()=>r.tbLoading=!1)}const ie=s=>{z({url:"/v1/website/delete",method:"post",data:{id:w.value[s].ID},dataType:"form"}).then(t=>{t.code===0&&(c.success("网站删除成功"),I({page:1,pagesize:r.pagesize}))}).catch(t=>{c.error("网站删除失败")})};return(s,t)=>{const n=He,d=qe,R=Me,se=Ne,ne=je,re=Pe,de=Oe,pe=Ae,ue=We,me=Q,L=ot,C=Te,fe=Re,ce=Ue,we=Fe,ge=mt,be=Je;return p(),V(j,null,[a(ue,{class:"box-card filemanager","body-style":"padding:0"},{header:l(()=>[h("div",ft,[f(" 网站管理 "),a(n,{type:"success",icon:A(Ge),onClick:t[0]||(t[0]=i=>ee(E.value))},null,8,["icon"])])]),footer:l(()=>[a(pe,{background:"",layout:"total,prev, pager, next",total:r.total,"page-size":r.pagesize,"current-page":r.currentpage,"onUpdate:currentPage":t[1]||(t[1]=i=>r.currentpage=i),"default-current-page":1,onChange:le},null,8,["total","page-size","current-page"])]),default:l(()=>[G((p(),U(de,{data:w.value,"min-height":"300",style:{width:"100%"},height:S.value,fit:""},{empty:l(()=>[a(re,{description:"暂无数据"},{default:l(()=>[a(n,{type:"primary",onClick:ae},{default:l(()=>[f("刷新")]),_:1})]),_:1})]),default:l(()=>[a(d,{type:"selection",width:"30"}),a(d,{prop:"domain",label:"域名","show-overflow-tooltip":""},{default:l(({row:i,$index:k})=>[a(n,{link:"",onClick:T(N=>oe(i.ID),["prevent"])},{icon:l(()=>[a(A(K),{icon:"dashicons:admin-site"})]),default:l(()=>[f(" "+F(i.domain),1)]),_:2},1032,["onClick"])]),_:1}),a(d,{prop:"title",label:"网站名称"}),a(d,{prop:"www_root",label:"站点目录"}),a(d,{prop:"status",label:"网站状态",width:"120"}),a(d,{fixed:"right",label:"操作",width:"100"},{default:l(i=>[a(n,{icon:A(Qe),circle:"",class:"mr-2 hidden-md-and-down",title:"设置网站",onClick:T(k=>M(i.row.ID),["prevent"])},null,8,["icon","onClick"]),a(ne,null,{dropdown:l(()=>[a(se,null,{default:l(()=>[a(R,{onClick:T(k=>ie(i.$index),["prevent"])},{default:l(()=>[f("删除")]),_:2},1032,["onClick"]),i.row.status==="running"?(p(),U(R,{key:0,onClick:T(k=>H(i.$index,"suspend"),["prevent"])},{default:l(()=>[f("暂停")]),_:2},1032,["onClick"])):y("",!0),i.row.status==="suspend"?(p(),U(R,{key:1,onClick:T(k=>H(i.$index,"running"),["prevent"])},{default:l(()=>[f("启动")]),_:2},1032,["onClick"])):y("",!0)]),_:2},1024)]),default:l(()=>[h("span",ct,[a(A(K),{icon:"ri:more-fill",width:"24",height:"24"})])]),_:2},1024)]),_:1})]),_:1},8,["data","height"])),[[be,r.tbLoading]])]),_:1}),a(ge,{modelValue:m.value,"onUpdate:modelValue":t[11]||(t[11]=i=>m.value=i),direction:"rtl",size:b.value,"show-close":!1},{header:l(({close:i,titleId:k,titleClass:N})=>[h("h4",{id:k,class:_(N)},F(D.value),11,wt),a(n,{onClick:i},{default:l(()=>[a(me,{class:"el-icon--left"},{default:l(()=>[a(A(Xe))]),_:1}),f(" 关闭 ")]),_:2},1032,["onClick"])]),default:l(()=>[a(we,{model:o,"label-position":"left",ref_key:"websiteFormDrawerRef",ref:E,rules:X},{default:l(()=>[a(C,{label:"域名","label-width":$,prop:"domain"},{default:l(()=>[a(L,{modelValue:o.domain,"onUpdate:modelValue":t[2]||(t[2]=i=>o.domain=i),autocomplete:"off",onChange:Y},null,8,["modelValue"])]),_:1}),a(C,{label:"附加域名","label-width":$,prop:"domain_names"},{default:l(()=>[a(L,{modelValue:o.domain_names,"onUpdate:modelValue":t[3]||(t[3]=i=>o.domain_names=i),autocomplete:"off",type:"textarea"},null,8,["modelValue"])]),_:1}),a(C,{label:"网站名称","label-width":$,prop:"title"},{default:l(()=>[a(L,{modelValue:o.title,"onUpdate:modelValue":t[4]||(t[4]=i=>o.title=i),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(C,{label:"站点目录","label-width":$,prop:"www_root"},{default:l(()=>[a(L,{modelValue:o.www_root,"onUpdate:modelValue":t[5]||(t[5]=i=>o.www_root=i),autocomplete:"off"},{prepend:l(()=>[f(F(g.config.home_dir)+"/",1)]),_:1},8,["modelValue"])]),_:1}),a(C,{label:"默认主页","label-width":$,prop:"index_files"},{default:l(()=>[a(L,{modelValue:o.index_files,"onUpdate:modelValue":t[6]||(t[6]=i=>o.index_files=i),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(C,{label:"应用类型","label-width":$,prop:"application"},{default:l(()=>[a(ce,{modelValue:o.application,"onUpdate:modelValue":t[7]||(t[7]=i=>o.application=i),class:"m-2",placeholder:"中间件服务器",style:{width:"240px"}},{default:l(()=>[(p(!0),V(j,null,Se(g.config.applications,(i,k)=>(p(),U(fe,{key:i.id,label:i.title,value:i.id},{default:l(()=>[h("span",gt,F(i.title),1),h("span",bt,F(i.expose_port),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(C,{label:"备注","label-width":$,prop:"description"},{default:l(()=>[a(L,{modelValue:o.description,"onUpdate:modelValue":t[8]||(t[8]=i=>o.description=i),autocomplete:"off",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),footer:l(()=>[h("div",_t,[a(n,{onClick:t[9]||(t[9]=i=>x(E.value))},{default:l(()=>[f("取消")]),_:1}),a(n,{type:"primary",onClick:t[10]||(t[10]=i=>te(E.value))},{default:l(()=>[f("确认")]),_:1})])]),_:1},8,["modelValue","size"])],64)}}},Zt=Ye(vt,[["__scopeId","data-v-32a761c6"]]);export{Zt as default};
