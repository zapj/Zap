import{x as c,b as a,c as l,a as d}from"./xterm-db03418d.js";import{c as m,Z as f,o as u,a as p,f as w,m as g}from"./index-5f1d5677.js";const x=function(s,t){const e=new c.Terminal({screenKeys:!0,useStyle:!0,cursorBlink:!0}),n=new a.FitAddon;return e.loadAddon(n),e.loadAddon(new l.WebLinksAddon),e.loadAddon(new d.AttachAddon(t)),e.open(document.getElementById(s)),e.onResize(function(o){t.send(new TextEncoder().encode(""+JSON.stringify({cols:o.cols,rows:o.rows}))),e.fit()}),e},_=function(s){let t="ws";return location.protocol==="https:"&&(t="wss"),new WebSocket(t+"://"+location.host+s,[sessionStorage.getItem("access_token")])},A={class:"log-viewer"},h=g("div",{id:"terminal"},null,-1),k=[h],S={__name:"LogViewer",props:{logfile:String},setup(s){const t=s,e=m(()=>t.logfile);var n,o;return f(e,(r,i)=>{o.clear(),n.send(new TextEncoder().encode(""+JSON.stringify({logfile:r})))}),u(()=>{n=_("/api/v1/wss/logviewer?log_file="+t.logfile),o=x("terminal",n),n.onmessage=r=>{o.writeln(r)},n.onclose=function(r){o.writeln("连接已关闭，请刷新重试")},n.onopen=()=>{o._initialized=!0,o.focus()}}),(r,i)=>(p(),w("div",A,k))}};export{S as default};
