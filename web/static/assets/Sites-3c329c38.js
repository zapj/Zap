import{b as ce,_ as fe,e as ge,E as J,at as be,f as F,r as h,u as we,au as ve,h as _e,a4 as I,o as u,l as U,B as t,m as o,S as K,a5 as w,F as he,A as B,s as b,j as y,q as A,a7 as L,D as k,U as ye,T as Ee,av as Ce,t as ke,O as q,y as ze,aw as Ve,ao as R,V as M,al as z,a6 as f,k as D,ax as $e,ay as Se,az as De,aa as j,aA as Le,aB as Fe}from"./index-cc2a4353.js";/* empty css                   */import{E as Ie,a as Ae}from"./el-form-item-35e22bd2.js";/* empty css                 *//* empty css               */import{E as Re,a as Ue,b as Be}from"./el-pagination-2838565b.js";import{E as Te}from"./el-card-5611bee7.js";import{E as We,a as Oe}from"./el-table-column-c16c73db.js";import{E as qe}from"./el-empty-5b679213.js";import{E as He}from"./index-f045ac76.js";import{d as Pe,a as Ne,u as Me}from"./use-dialog-c3b107d2.js";import{b as je}from"./index-9caf0bc1.js";import{u as G,E as Ge}from"./index-c42dd105.js";import{E as Je,a as Ke,b as Qe}from"./index-4a60c7b6.js";import{E as Xe}from"./index-1ac84a8f.js";import"./use-form-common-props-8b319def.js";import"./castArray-e6ec1248.js";import"./event-2c073216.js";import"./use-form-item-f5a99179.js";import"./_initCloneObject-d853220d.js";import"./index-b56c9399.js";import"./isNil-c75b1b34.js";const Ye=ce({...Pe,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0},headerAriaLevel:{type:String,default:"2"}}),Ze=Ne,xe=ge({name:"ElDrawer",components:{ElOverlay:He,ElFocusTrap:je,ElIcon:J,Close:be},inheritAttrs:!1,props:Ye,emits:Ze,setup(e,{slots:d}){G({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},F(()=>!!d.title)),G({scope:"el-drawer",from:"custom-class",replacement:"class",version:"2.3.0",ref:"https://element-plus.org/en-US/component/drawer.html#attributes",type:"Attribute"},F(()=>!!e.customClass));const v=h(),E=h(),c=we("drawer"),{t:_}=ve(),n=F(()=>e.direction==="rtl"||e.direction==="ltr"),m=F(()=>_e(e.size));return{...Me(e,v),drawerRef:v,focusStartRef:E,isHorizontal:n,drawerSize:m,ns:c,t:_}}}),et=["aria-label","aria-labelledby","aria-describedby"],tt=["id","aria-level"],ot=["aria-label"],at=["id"];function lt(e,d,v,E,c,_){const n=I("close"),m=I("el-icon"),r=I("el-focus-trap"),T=I("el-overlay");return u(),U(Ce,{to:"body",disabled:!e.appendToBody},[t(Ee,{name:e.ns.b("fade"),onAfterEnter:e.afterEnter,onAfterLeave:e.afterLeave,onBeforeLeave:e.beforeLeave,persisted:""},{default:o(()=>[K(t(T,{mask:e.modal,"overlay-class":e.modalClass,"z-index":e.zIndex,onClick:e.onModalClick},{default:o(()=>[t(r,{loop:"",trapped:e.visible,"focus-trap-el":e.drawerRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:o(()=>[w("div",he({ref:"drawerRef","aria-modal":"true","aria-label":e.title||void 0,"aria-labelledby":e.title?void 0:e.titleId,"aria-describedby":e.bodyId},e.$attrs,{class:[e.ns.b(),e.direction,e.visible&&"open",e.customClass],style:e.isHorizontal?"width: "+e.drawerSize:"height: "+e.drawerSize,role:"dialog",onClick:d[1]||(d[1]=B(()=>{},["stop"]))}),[w("span",{ref:"focusStartRef",class:b(e.ns.e("sr-focus")),tabindex:"-1"},null,2),e.withHeader?(u(),y("header",{key:0,class:b(e.ns.e("header"))},[e.$slots.title?A(e.$slots,"title",{key:1},()=>[k(" DEPRECATED SLOT ")]):A(e.$slots,"header",{key:0,close:e.handleClose,titleId:e.titleId,titleClass:e.ns.e("title")},()=>[e.$slots.title?k("v-if",!0):(u(),y("span",{key:0,id:e.titleId,role:"heading","aria-level":e.headerAriaLevel,class:b(e.ns.e("title"))},L(e.title),11,tt))]),e.showClose?(u(),y("button",{key:2,"aria-label":e.t("el.drawer.close"),class:b(e.ns.e("close-btn")),type:"button",onClick:d[0]||(d[0]=(...W)=>e.handleClose&&e.handleClose(...W))},[t(m,{class:b(e.ns.e("close"))},{default:o(()=>[t(n)]),_:1},8,["class"])],10,ot)):k("v-if",!0)],2)):k("v-if",!0),e.rendered?(u(),y("div",{key:1,id:e.bodyId,class:b(e.ns.e("body"))},[A(e.$slots,"default")],10,at)):k("v-if",!0),e.$slots.footer?(u(),y("div",{key:2,class:b(e.ns.e("footer"))},[A(e.$slots,"footer")],2)):k("v-if",!0)],16,et)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[ye,e.visible]])]),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["disabled"])}var st=fe(xe,[["render",lt],["__file","drawer.vue"]]);const nt=ke(st);const rt={class:"card-header font-size-3"},it={class:"el-dropdown-link"},dt=["id"],pt={style:{float:"left"}},ut={style:{float:"right",color:"var(--el-text-color-secondary)"}},mt={style:{flex:"auto"}},V="140px",Ut={__name:"Sites",setup(e){const d=h([]),v=h(400),E=h(),c=h(!1),_=h("50%"),n=q({domain:"",title:"",description:"",domain_names:"",www_root:"",run_directory:"",application:0}),m=q({config:{}}),r=q({total:0,pagesize:50,currentpage:1,tbLoading:!1}),T={domain:[{required:!0,message:"请输入域名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],title:[{required:!0,message:"请输入网站名称",trigger:"blur"}],www_root:[{required:!0,message:"请输入站点目录",trigger:"blur"}]},W=()=>{n.www_root=n.domain.replaceAll("*.",""),n.title===""&&(n.title=n.domain.replaceAll("www.",""))},Q=()=>{R({url:"/v1/website/config",method:"get"}).then(s=>{if(s.code===0)m.config=s.data;else{z.error(s.msg),c.value=!1;return}console.log(m.config)})},X=s=>{s&&(s.resetFields(),c.value=!1)},Y=s=>{if(!s)return;s.validate(p=>{if(!p)return!1});let a=Object.assign({},n);if(m.config.applications.length===0){z.error("请先添加应用");return}let i=m.config.applications[n.application];a.expose_port=i.expose_port,a.expose_proto=i.expose_proto,a.application=i.id,R({url:"/v1/website/create",method:"post",data:a}).then(p=>{p.code===0&&(z.success("添加成功"),c.value=!1,$({page:1,pagesize:r.pagesize}))}).finally(()=>{s.resetFields()})},Z=s=>{z.success("打开网站")},x=()=>{$({page:r.currentpage,pagesize:r.pagesize})},ee=(s,a)=>{r.currentpage=s,r.pagesize=a,$({page:s,pagesize:a})},O=()=>{document.body.clientWidth<1200&&document.body.clientWidth>768?_.value="60%":document.body.clientWidth<768?_.value="100%":_.value="50%";let s=document.body.clientHeight-215-140;s<300?v.value=300:v.value=s};ze(()=>{$({page:1,pagesize:r.pagesize}),window.addEventListener("resize",O)}),Ve(()=>{window.removeEventListener("resize",O)});function $(s){s=Object.assign({page:1,pagesize:50},s),r.tbLoading=!0,R({url:"/v1/website/list",method:"get",params:{path:s.path,page:s.page,limit:s.pagesize},dataType:"form",loading:!1}).then(i=>{d.value=[],d.value.push(...i.data),r.total=i.total,r.currentpage=i.page,O()}).catch(i=>{console.log(i)}).finally(()=>r.tbLoading=!1)}const te=s=>{console.log(d.value[s]),R({url:"/v1/website/delete",method:"post",data:{id:d.value[s].ID},dataType:"form"}).then(a=>{a.code===0&&(z.success("网站删除成功"),$({page:1,pagesize:r.pagesize}))}).catch(a=>{z.error("网站删除失败")})};return(s,a)=>{const i=Ge,p=We,H=Je,oe=Ke,ae=Qe,le=qe,se=Oe,ne=Re,re=Te,ie=J,S=Xe,C=Ie,P=Be,de=Ue,pe=Ae,ue=nt,me=Se;return u(),y(M,null,[t(re,{class:"box-card filemanager"},{header:o(()=>[w("div",rt,[f(" 网站管理 "),t(i,{type:"primary",icon:D(De),onClick:a[0]||(a[0]=l=>c.value=!0)},null,8,["icon"])])]),footer:o(()=>[t(ne,{background:"",layout:"total,prev, pager, next",total:r.total,"page-size":r.pagesize,"current-page":r.currentpage,"onUpdate:currentPage":a[1]||(a[1]=l=>r.currentpage=l),"default-current-page":1,onChange:ee},null,8,["total","page-size","current-page"])]),default:o(()=>[K((u(),U(se,{data:d.value,"min-height":"200",style:{width:"100%"},height:v.value,fit:""},{empty:o(()=>[t(le,{description:"暂无数据"},{default:o(()=>[t(i,{type:"primary",onClick:x},{default:o(()=>[f("刷新")]),_:1})]),_:1})]),default:o(()=>[t(p,{type:"selection",width:"30"}),t(p,{prop:"domain",label:"域名","show-overflow-tooltip":""},{default:o(({row:l,$index:g})=>[t(i,{link:"",onClick:B(N=>Z(g),["prevent"])},{icon:o(()=>[t(D(j),{icon:"dashicons:admin-site"})]),default:o(()=>[f(" "+L(l.domain),1)]),_:2},1032,["onClick"])]),_:1}),t(p,{prop:"title",label:"网站名称"}),t(p,{prop:"description",label:"描述"}),t(p,{prop:"www_root",label:"站点目录"}),t(p,{prop:"status",label:"网站状态",width:"120"}),t(p,{fixed:"right",label:"操作",width:"100"},{default:o(l=>[t(i,{icon:D(Le),circle:"",class:"mr-2 hidden-md-and-down",title:"设置网站",onClick:B(g=>s.openFile(l.$index),["prevent"])},null,8,["icon","onClick"]),t(ae,null,{dropdown:o(()=>[t(oe,null,{default:o(()=>[t(H,{onClick:B(g=>te(l.$index),["prevent"])},{default:o(()=>[f("删除")]),_:2},1032,["onClick"]),t(H,null,{default:o(()=>[f("停止")]),_:1})]),_:2},1024)]),default:o(()=>[w("span",it,[t(D(j),{icon:"ri:more-fill",width:"24",height:"24"})])]),_:2},1024)]),_:1})]),_:1},8,["data","height"])),[[me,r.tbLoading]])]),_:1}),t(ue,{modelValue:c.value,"onUpdate:modelValue":a[10]||(a[10]=l=>c.value=l),direction:"rtl",size:_.value,"show-close":!1,onOpen:Q},{header:o(({close:l,titleId:g,titleClass:N})=>[w("h4",{id:g,class:b(N)},"添加网站",10,dt),t(i,{onClick:l},{default:o(()=>[t(ie,{class:"el-icon--left"},{default:o(()=>[t(D(Fe))]),_:1}),f(" 关闭 ")]),_:2},1032,["onClick"])]),default:o(()=>[t(pe,{model:n,"label-position":"left",ref_key:"websiteFormDrawerRef",ref:E,rules:T},{default:o(()=>[t(C,{label:"域名","label-width":V,prop:"domain"},{default:o(()=>[t(S,{modelValue:n.domain,"onUpdate:modelValue":a[2]||(a[2]=l=>n.domain=l),autocomplete:"off",onChange:W},null,8,["modelValue"])]),_:1}),t(C,{label:"附加域名","label-width":V,prop:"domain_names"},{default:o(()=>[t(S,{modelValue:n.domain_names,"onUpdate:modelValue":a[3]||(a[3]=l=>n.domain_names=l),autocomplete:"off",type:"textarea"},null,8,["modelValue"])]),_:1}),t(C,{label:"网站名称","label-width":V,prop:"title"},{default:o(()=>[t(S,{modelValue:n.title,"onUpdate:modelValue":a[4]||(a[4]=l=>n.title=l),autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(C,{label:"站点目录","label-width":V,prop:"www_root"},{default:o(()=>[t(S,{modelValue:n.www_root,"onUpdate:modelValue":a[5]||(a[5]=l=>n.www_root=l),autocomplete:"off"},{prepend:o(()=>[f(L(m.config.home_dir)+"/",1)]),_:1},8,["modelValue"])]),_:1}),t(C,{label:"中间件","label-width":V,prop:"application"},{default:o(()=>[t(de,{modelValue:n.application,"onUpdate:modelValue":a[6]||(a[6]=l=>n.application=l),class:"m-2",placeholder:"Select",style:{width:"240px"}},{default:o(()=>[(u(),U(P,{value:0,label:"静态网站",key:0})),(u(!0),y(M,null,$e(m.config.applications,(l,g)=>(u(),U(P,{key:g+1,label:l.title,value:g+1},{default:o(()=>[w("span",pt,L(l.title),1),w("span",ut,L(l.expose_port),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(C,{label:"备注","label-width":V,prop:"description"},{default:o(()=>[t(S,{modelValue:n.description,"onUpdate:modelValue":a[7]||(a[7]=l=>n.description=l),autocomplete:"off",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),footer:o(()=>[w("div",mt,[t(i,{onClick:a[8]||(a[8]=l=>X(E.value))},{default:o(()=>[f("取消")]),_:1}),t(i,{type:"primary",onClick:a[9]||(a[9]=l=>Y(E.value))},{default:o(()=>[f("确认")]),_:1})])]),_:1},8,["modelValue","size"])],64)}}};export{Ut as default};
