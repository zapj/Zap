import{J as D,r as c,o as S,N as F,a as f,b as k,w as t,m as N,t as w,j as e,p,e as y,f as I,F as R,ai as L}from"./index-4558e22a.js";import{E as M,a as W}from"./el-table-column-b859fd1c.js";import"./el-tooltip-6ba31a31.js";import"./el-scrollbar-46eb1487.js";import{E as A}from"./el-button-5a1e2e41.js";/* empty css               */import{a as h}from"./client-5d52aa59.js";import{I as $}from"./iconify-9f979980.js";import{E as P}from"./el-drawer-83ba0785.js";import"./el-overlay-4232514c.js";import{E as j,a as q}from"./el-form-item-e763ec48.js";import{E as J}from"./el-input-f87981a3.js";import{E as G,a as H}from"./el-descriptions-item-6f0e5b00.js";import{_ as K}from"./_plugin-vue_export-helper-c27b6911.js";import{E as v}from"./index-21c5f4c3.js";import{E as T}from"./index-7df96f5b.js";import{E as O}from"./index-5616edc7.js";import"./error-78e43d3e.js";import"./runtime-e5f589df.js";import"./_initCloneObject-a960cf27.js";import"./use-global-config-0868fc11.js";import"./index-60a14872.js";import"./index-6615aa32.js";import"./event-8e91c63d.js";import"./use-form-common-props-276dc413.js";import"./constants-84857360.js";import"./use-form-item-71c26730.js";import"./index-ae1427e5.js";import"./isNil-c75b1b34.js";import"./typescript-00cc0b5d.js";import"./focus-trap-8187f18e.js";import"./index-20939992.js";import"./vnode-dafc8873.js";import"./castArray-ee17caab.js";import"./aria-bc8e8b0f.js";import"./index-5175c219.js";const Q={__name:"AppSettingView",setup(B,{expose:g}){let m="50%";const o=D({config_file:"",pid_file:"",id:0,expose:"",settings:""}),x=c(),s=c({});S(()=>{window.addEventListener("resize",_),console.log("mounted drawer")}),F(()=>{window.removeEventListener("resize",_)});const _=()=>{document.body.clientWidth<1200&&document.body.clientWidth>768?m="60%":document.body.clientWidth<768?m="100%":m="50%"};function E(){h({url:"/v1/app/appstore/save/settings",method:"post",data:o,dataType:"form"}).then(l=>{l.code==0?v({type:"success",message:l.msg}):v({type:"error",message:l.msg})})}return g({setAppInfo:function(l){s.value=l,o.id=s.value.id,o.expose=l.expose,o.config_file=l.config_file,o.pid_file=l.pid_file,o.settings=l.settings}}),(l,a)=>{const u=G,b=T,V=H,n=J,r=j,z=A,C=q,U=P;return f(),k(U,{title:"应用设置",size:y(m),"append-to-body":!0,direction:"rtl"},{header:t(()=>[N("span",null,"安装"+w(s.value.title),1)]),default:t(()=>[e(V,{title:"应用信息",column:1},{default:t(()=>[e(u,{label:"应用名称"},{default:t(()=>[p(w(s.value.title),1)]),_:1}),e(u,{label:"描述"},{default:t(()=>[p(w(s.value.description),1)]),_:1}),e(u,{label:"版本"},{default:t(()=>[e(b,{size:"small",class:"me-2"},{default:t(()=>[p(w(s.value.version),1)]),_:1})]),_:1})]),_:1}),e(C,{ref_key:"formRef",ref:x,model:o,"label-width":"auto"},{default:t(()=>[e(r,{label:"安装目录"},{default:t(()=>[e(n,{value:s.value.install_dir,disabled:""},null,8,["value"])]),_:1}),e(r,{label:"配置文件"},{default:t(()=>[e(n,{modelValue:o.config_file,"onUpdate:modelValue":a[0]||(a[0]=d=>o.config_file=d),placeholder:"etc: /etc/nginx/nginx.conf"},null,8,["modelValue"])]),_:1}),e(r,{label:"Pid 文件"},{default:t(()=>[e(n,{modelValue:o.pid_file,"onUpdate:modelValue":a[1]||(a[1]=d=>o.pid_file=d),placeholder:"etc: /run/nginx/nginx.pid"},null,8,["modelValue"])]),_:1}),e(r,{label:"Expose"},{default:t(()=>[e(n,{modelValue:o.expose,"onUpdate:modelValue":a[2]||(a[2]=d=>o.expose=d),type:"textarea",autosize:{minRows:2,maxRows:5}},null,8,["modelValue"])]),_:1}),e(r,{label:"Settings"},{default:t(()=>[e(n,{modelValue:o.settings,"onUpdate:modelValue":a[3]||(a[3]=d=>o.settings=d),type:"textarea",autosize:{minRows:2,maxRows:10}},null,8,["modelValue"])]),_:1}),e(r,null,{default:t(()=>[e(z,{type:"warning"},{default:t(()=>[p("取消")]),_:1}),e(z,{type:"success",onClick:E},{default:t(()=>[p("保存")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["size"])}}},X=K(Q,[["__scopeId","data-v-9d83090b"]]),Ue={__name:"AppInstalledView",setup(B){const g=c([]),m=c(),o=c(!1);S(()=>{_()});const x=i=>{O.confirm("确定要卸载"+i.name+"吗？","warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",callback:l=>{l==="confirm"&&s(i)}})},s=i=>{h({url:"/v1/app/appstore/uninstall",method:"post",data:{id:i.id},dataType:"form"}).then(l=>{v({type:l.code===0?"success":"error",message:l.msg}),_()})},_=()=>{h({url:"/v1/app/appstore/already_install",loading:!1}).then(i=>{if(i.code!==0){v({type:"error",message:i.msg});return}g.value=i.data})},E=i=>{o.value=!0,m.value.setAppInfo(i)};return(i,l)=>{const a=M,u=T,b=A,V=W;return f(),I(R,null,[e(V,{data:y(g),stripe:"",style:{width:"100%"}},{default:t(()=>[e(a,{prop:"id",label:"Id",width:"50"}),e(a,{prop:"name",label:"Name",width:"150"}),e(a,{prop:"title",label:"Title"}),e(a,{prop:"version",label:"版本"}),e(a,{prop:"status",label:"状态",width:"100"}),e(a,{prop:"app_status",label:"运行状态"},{default:t(n=>[n.row.app_status==="running"&&n.row.pid_file?(f(),k(u,{key:0,type:"success"},{default:t(()=>[p("运行中")]),_:1})):n.row.app_status==="stop"&&n.row.pid_file?(f(),k(u,{key:1,type:"info"},{default:t(()=>[p("已停止")]),_:1})):(f(),I(R,{key:2},[],64))]),_:1}),e(a,{prop:"install_date",label:"安装时间"}),e(a,{fixed:"right",label:"操作",width:"120"},{default:t(n=>[e(b,{link:"",type:"primary",size:"small",onClick:r=>E(n.row)},{default:t(()=>[e(y($),{icon:"mdi:settings-outline"}),p(" 设置")]),_:2},1032,["onClick"]),e(b,{link:"",type:"primary",size:"small",onClick:r=>x(n.row)},{default:t(()=>[p("卸载")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(X,{modelValue:y(o),"onUpdate:modelValue":l[0]||(l[0]=n=>L(o)?o.value=n:null),ref_key:"appSettingRef",ref:m},null,8,["modelValue"])],64)}}};export{Ue as default};
