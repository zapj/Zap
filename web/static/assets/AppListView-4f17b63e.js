import{J as O,r as b,o as F,N as S,a as o,b as u,w as e,m as v,t as i,j as s,p as m,f as c,F as d,P as E,h as I,k as N,e as D,ai as j}from"./index-4558e22a.js";import{E as q,a as G}from"./el-col-952076e8.js";import{E as J}from"./el-card-ed177746.js";import{E as $}from"./el-button-5a1e2e41.js";/* empty css               */import{a as T}from"./client-5d52aa59.js";import{E as P}from"./el-drawer-83ba0785.js";import"./el-overlay-4232514c.js";import{E as H,a as K}from"./el-form-item-e763ec48.js";import{b as Q,a as X}from"./el-radio-button-f0126f69.js";import{E as Y,a as Z}from"./el-descriptions-item-6f0e5b00.js";import{_ as ee}from"./_plugin-vue_export-helper-c27b6911.js";import{E as L}from"./index-21c5f4c3.js";import{E as M}from"./index-7df96f5b.js";import"./runtime-e5f589df.js";import"./typescript-00cc0b5d.js";import"./index-60a14872.js";import"./index-20939992.js";import"./use-global-config-0868fc11.js";import"./index-6615aa32.js";import"./use-form-item-71c26730.js";import"./constants-84857360.js";import"./index-ae1427e5.js";import"./use-form-common-props-276dc413.js";import"./focus-trap-8187f18e.js";import"./isNil-c75b1b34.js";import"./vnode-dafc8873.js";import"./event-8e91c63d.js";import"./error-78e43d3e.js";import"./castArray-ee17caab.js";import"./_initCloneObject-a960cf27.js";const te={__name:"InstallConfirm",setup(U,{expose:C}){let _="50%";const p=O({version:"",id:0}),y=b(),t=b({});F(()=>{window.addEventListener("resize",x)}),S(()=>{window.removeEventListener("resize",x)});const x=()=>{document.body.clientWidth<1200&&document.body.clientWidth>768?_="60%":document.body.clientWidth<768?_="100%":_="50%"};function r(g){T({url:"/v1/app/appstore/install",method:"post",data:{id:t.value.app_id,action:g,version:p.version},dataType:"form"}).then(l=>{console.log(l),l.code==0?L({type:"success",message:l.msg}):L({type:"error",message:l.msg})})}return C({setAppInfo:function(g){t.value=g,p.id=t.value.id;for(let l=0;l<t.value.version.length;l++)if(t.value.already_installed_version.indexOf(t.value.version[l])!==-1){t.value.version[l];break}}}),(g,l)=>{const k=Y,V=M,A=Z,a=Q,h=X,z=H,R=$,B=K,W=P;return o(),u(W,{title:"安装确认",size:D(_),"append-to-body":!0,direction:"rtl"},{header:e(()=>[v("span",null,"安装"+i(t.value.title),1)]),default:e(()=>[s(A,{title:"应用信息",column:1},{default:e(()=>[s(k,{label:"应用名称"},{default:e(()=>[m(i(t.value.title),1)]),_:1}),s(k,{label:"Tag"},{default:e(()=>[(o(!0),c(d,null,E(t.value.tags,(n,f)=>(o(),u(V,{size:"small",class:"me-2",key:f},{default:e(()=>[m(i(n),1)]),_:2},1024))),128))]),_:1}),s(k,{label:"描述"},{default:e(()=>[m(i(t.value.description),1)]),_:1}),s(k,{label:"版本"},{default:e(()=>[(o(!0),c(d,null,E(t.value.version,(n,f)=>(o(),u(V,{size:"small",key:f,class:"me-2"},{default:e(()=>[m(i(n),1)]),_:2},1024))),128))]),_:1})]),_:1}),s(B,{ref_key:"formRef",ref:y,model:p,"label-width":"auto"},{default:e(()=>[s(z,{label:"选择安装的版本"},{default:e(()=>[s(h,{modelValue:p.version,"onUpdate:modelValue":l[0]||(l[0]=n=>p.version=n)},{default:e(()=>[(o(!0),c(d,null,E(t.value.version,(n,f)=>(o(),u(a,{border:"",value:n,label:n,disabled:t.value.already_installed_version.indexOf(n)!==-1,key:f},{default:e(()=>[m(i(n),1)]),_:2},1032,["value","label","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(z,null,{default:e(()=>[t.value.actions&&t.value.allow_installation==="yes"?(o(!0),c(d,{key:0},E(t.value.actions,(n,f)=>(o(),u(R,{type:"success",onClick:I(re=>r(f),["prevent"])},{default:e(()=>[m(i(n),1)]),_:2},1032,["onClick"]))),256)):(o(),c(d,{key:1},[t.value.allow_installation==="yes"?(o(),u(R,{key:0,type:"success",onClick:l[1]||(l[1]=I(n=>r("install"),["prevent"]))},{default:e(()=>[m("安装")]),_:1})):N("",!0)],64))]),_:1})]),_:1},8,["model"])]),_:1},8,["size"])}}},oe=ee(te,[["__scopeId","data-v-ee982983"]]),le={style:{padding:"14px"}},ne=["textContent"],se=["textContent"],ae={class:"bottom mt-2"},ie={class:"time font-size-3 ms-2 me-2"},We={__name:"AppListView",setup(U){const C=b(),_=b(),p=b(),y=b(!1);F(()=>{t()});const t=()=>{T({url:"/v1/app/appstore",loading:!1}).then(r=>{if(r.code!==0){L.error(r.msg);return}else C.value=r.data})};function x(r,w){_.value=C.value[r],_.value.action=w,p.value.setAppInfo(_.value),y.value=!0}return(r,w)=>{const g=M,l=$,k=J,V=q,A=G;return o(),c(d,null,[s(A,{gutter:20},{default:e(()=>[(o(!0),c(d,null,E(D(C),(a,h)=>(o(),u(V,{xs:24,sm:24,md:8,lg:8,xl:6,class:"mb-2",key:h},{default:e(()=>[s(k,{"body-style":{padding:"0px"},shadow:"hover"},{default:e(()=>[v("div",le,[v("div",null,[v("h3",{textContent:i(a.title),class:"font-size-4"},null,8,ne),v("p",{textContent:i(a.description),class:"font-size-3"},null,8,se)]),v("div",ae,[s(g,{class:"tag",type:"info",effect:"dark",size:"small",textContent:i(a.category)},null,8,["textContent"]),v("time",ie,"latest:"+i(a.version[0]),1),a.actions&&a.allow_installation==="yes"?(o(!0),c(d,{key:0},E(a.actions,(z,R)=>(o(),u(l,{type:"success",onClick:I(B=>x(h,R),["prevent"])},{default:e(()=>[m(i(z),1)]),_:2},1032,["onClick"]))),256)):(o(),c(d,{key:1},[a.allow_installation==="yes"?(o(),u(l,{key:0,type:"success",onClick:I(z=>x(h,"install"),["prevent"])},{default:e(()=>[m("安装")]),_:2},1032,["onClick"])):N("",!0)],64))])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),s(oe,{ref_key:"installConfirmRef",ref:p,modelValue:D(y),"onUpdate:modelValue":w[0]||(w[0]=a=>j(y)?y.value=a:null)},null,8,["modelValue"])],64)}}};export{We as default};
